<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="./login.css">
    <link rel="stylesheet" href="./style.css">
</head>

<body>

    <nav>
        <div class="main_img">
            <div class="gadi1"> <img src="./images/gadi.png" alt=""></div>
            <div class="logo1"><img src="./images/tYPO TALES.png" alt=""></div>
        </div>
        <div class="nav-items">
            <a href="#">Pit Stop</a>
            <a href="#">Updates</a>
            <a href="#">Discord</a>
            <a href="./about.html">About</a>
            <a href="#">Merch</a>
            <div></div>
        </div>
        <div class="rdnav">
            <div class="upperpart">
                <p>Guest</p>
            </div>
            <div class="lowerpart">
                <a href=""><button class="createAc">Vishal</button></a>
                <a href=""><button class="signin1">Ex-c</button></a>
                <a href=""><button id="infomaster1">30 WPM</button></a>
                <a href=""><button id="infomaster2">10 Races</button></a>
                <a href="./login.html"><button id="logout">Logout</button></a>

            </div>
        </div>
    </nav><br>

    <div class="mainlogin">

        <div class="container">
            <div class="card">
                <br>
                <a class="login">Log in</a>
                <div class="inputBox">
                    <input id="username" type="text" required="required">
                    <span class="user">Username</span>
                </div><br>

                <div class="inputBox">
                    <input id="password" type="password" required="required">
                    <span>Password</span>
                </div><br>

                <button id="enter" class="enter">Enter</button>
                <a class="anchorlogin" href="./signup.html">Already have account ? <span class="clickhere">click
                        here</span></a>
            </div>
        </div>

        <div class="imagelogin">
            <div class="card2">
                <div class="typewriter">
                    <div class="slide"><i></i></div>
                    <div class="paper"></div>
                    <div class="keyboard"></div>
                </div>

                <div class="herediv1">
                    <img src="./images/gadi.png" alt="">
                </div>
                <div class="herediv2">
                    <img src="./images/tYPO TALES 1.png" alt="">
                </div>
            </div>
        </div>
    </div>

    <div class="module" id="cart-module">
        <span>Proceed To Checkout</span>
        <span class="module-close" onclick="closeModule()">&times;</span>
    </div>


</body>


</html>

<script>



    let enter = document.getElementById("enter");
    let username = document.getElementById("username")
    let password = document.getElementById("password")


    enter.addEventListener("click", async () => {

        if (username.value == "" || password.value == "") {
            const module = document.getElementById('cart-module');
            module.innerText = "Please Fill All The Fields !"
            module.style.display = 'block';
            module.style.borderRadius = '20px';
            module.style.backgroundColor = '#FF9100'

            if ('speechSynthesis' in window) {
                const message = new SpeechSynthesisUtterance('Please Fill All The Fields !');
                const femaleVoices = speechSynthesis.getVoices().filter(voice => voice.name.includes('female'));
                if (femaleVoices.length > 0) {
                    message.voice = femaleVoices[0];
                }
                speechSynthesis.speak(message);
            }


            setTimeout(() => {
                window.location.reload()
            }, 3000);

            return
        }


        let payload = {
            username: username.value,
            password: password.value
        }

        console.log(payload)

        let s = await fetch("http://localhost:8080/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        })
        let res = await s.json()
        console.log(res)

        if (res.msg == "login sucessfull") {
            window.location.href = "./index.html"
            localStorage.setItem("token", res.normal_token)
            localStorage.setItem("username", res.user[0].username)

        } else {
            const module = document.getElementById('cart-module');
            module.innerText = "Wrong Credentials !"
            module.style.display = 'block';
            module.style.borderRadius = '20px';
            module.style.backgroundColor = 'red'

            if ('speechSynthesis' in window) {
                const message = new SpeechSynthesisUtterance('Wrong Credentials !');
                const femaleVoices = speechSynthesis.getVoices().filter(voice => voice.name.includes('female'));
                if (femaleVoices.length > 0) {
                    message.voice = femaleVoices[0];
                }
                speechSynthesis.speak(message);
            }


            setTimeout(() => {
                window.location.reload()
            }, 3000);

            return
        }
    })


</script>